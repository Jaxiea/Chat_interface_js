<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fetch</title>
</head>
<body>
  <h2>Here we will put the messages.</h2>
  <div id="Message Screen">
  </div>

  <script>
  const AllMessagesURL = 'https://chatty.kubernetes.doodle-test.com/api/chatty/v1.0/?token=4hbLloOBHnKP';
  var messages;
  const POSTurl = 'https://chatty.kubernetes.doodle-test.com/api/chatty/v1.0';

  async function getMessages(){

    const response = await fetch(AllMessagesURL);
    const data = await response.json();
    console.log(data);

    for (let i = 0; i < data.length; i++){
      var node = document.createElement("p");
      var author = document.createTextNode(data[i].author);
      var message = document.createTextNode(data[i].message);

      var formattedTime = convertTimestamp(data[i].timestamp);

      var time = document.createTextNode(formattedTime);         // Create a text node


      node.appendChild(author);
      node.appendChild(message);
      node.appendChild(time);
      document.getElementById('Message Screen').appendChild(node);
    }
  }


  function convertTimestamp(stamp){

    var fullDate = new Date(stamp * 1000);
    console.log(fullDate);

    var days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    var day = days[fullDate.getDay()];
    console.log(day);

    var month = fullDate.getMonth();

    var date = fullDate.getDate();

    var hours = fullDate.getHours();

    var minutes = "0" + fullDate.getMinutes();

//    var seconds = "0" + date.getSeconds();

    // Will display time in weekday month/day \n 10:30 format
    var formattedTime = hours + ':' + minutes.substr(-2) + " " + day + " " + month + "/" + date;

    return formattedTime;

  }



  async function sendMessage(){
    const timestamp = Date.now();
    const messageObj = {
      message:"What?",
      author:"Pete"
    }

    const options = {
      method: 'POST',
      body: JSON.stringify(messageObj),
      headers: {
        'Content-Type': 'application/json',
        'token': '4hbLloOBHnKP',
      }
    }

    fetch(POSTurl, options)
    .then(res => res.json())
    .then(res => console.log(res));
  }

  //  sendMessage();
  getMessages();

  //asychronous! What to do?


  </script>
</body>
</html>
